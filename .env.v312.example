# ============================================================================
# PARIS ELITE SERVICES - VARIABLES DE ENTORNO V3.1.2
# ============================================================================
#
# Este archivo contiene las variables de entorno necesarias para el sistema
# de pagos V3.1.2
#
# INSTRUCCIONES:
# 1. Copiar este archivo a `.env.local`
# 2. Completar los valores reales
# 3. NO commitear el archivo .env.local
#
# ============================================================================

# ----------------------------------------------------------------------------
# STRIPE CONFIGURATION
# ----------------------------------------------------------------------------

# Stripe API Keys
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLISHABLE_KEY=pk_test_...

# Stripe Webhook Secrets
# Crear en: https://dashboard.stripe.com/webhooks
STRIPE_WEBHOOK_SECRET_V312=whsec_...

# Stripe Fee Configuration (V3.1.2)
# Worst case scenario para validación de márgenes
STRIPE_WORST_CASE_FEE_PERCENT=3.5
STRIPE_WORST_CASE_FEE_FIXED_EUR=0.25

# ----------------------------------------------------------------------------
# SUPABASE CONFIGURATION
# ----------------------------------------------------------------------------

# Supabase URL y Keys
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# ----------------------------------------------------------------------------
# PRICING V3.1.2
# ----------------------------------------------------------------------------

# Versión del sistema de precios
PRICING_VERSION=v3.1.2

# Habilitar/deshabilitar modos de pago
ENABLE_PREPAID_MODE=true
ENABLE_FLEXIBLE_MODE=true

# Beauvais: prepaid-only (no cambiar)
BEAUVAIS_PREPAID_ONLY=true

# ----------------------------------------------------------------------------
# JOBS CONFIGURATION
# ----------------------------------------------------------------------------

# Hold Job - Frecuencia de ejecución (minutos)
HOLD_JOB_INTERVAL_MINUTES=60

# Hold Job - Ventana de tiempo (horas antes del pickup)
HOLD_JOB_WINDOW_HOURS=24

# SCA Authentication Deadline (horas)
SCA_AUTH_DEADLINE_HOURS=2

# ----------------------------------------------------------------------------
# NOTIFICATIONS
# ----------------------------------------------------------------------------

# WhatsApp/SMS (opcional - para notificaciones de SCA)
TWILIO_ACCOUNT_SID=AC...
TWILIO_AUTH_TOKEN=...
TWILIO_WHATSAPP_NUMBER=whatsapp:+14155238886
TWILIO_SMS_NUMBER=+1...

# Email (opcional - para notificaciones)
SENDGRID_API_KEY=SG...
SENDGRID_FROM_EMAIL=noreply@pariselite.com

# ----------------------------------------------------------------------------
# ADMIN PANEL
# ----------------------------------------------------------------------------

# Admin Authentication
ADMIN_JWT_SECRET=your-secret-key-here
ADMIN_SESSION_DURATION_HOURS=24

# Admin Panel URL
ADMIN_PANEL_URL=https://admin.pariselite.com

# ----------------------------------------------------------------------------
# LOGGING & MONITORING
# ----------------------------------------------------------------------------

# Log Level (debug, info, warn, error)
LOG_LEVEL=info

# Sentry (opcional)
SENTRY_DSN=https://...@sentry.io/...
SENTRY_ENVIRONMENT=production

# ----------------------------------------------------------------------------
# FEATURE FLAGS
# ----------------------------------------------------------------------------

# Habilitar sistema V3.1.2 (gradual rollout)
ENABLE_V312_SYSTEM=true

# Porcentaje de tráfico a V3.1.2 (0-100)
V312_ROLLOUT_PERCENTAGE=100

# Rutas habilitadas para V3.1.2 (comma-separated)
V312_ENABLED_ROUTES=CDG_PARIS,ORLY_PARIS,BEAUVAIS_PARIS

# ----------------------------------------------------------------------------
# DEVELOPMENT
# ----------------------------------------------------------------------------

# Node Environment
NODE_ENV=production

# API Base URL
API_BASE_URL=https://api.pariselite.com

# Frontend URL
FRONTEND_URL=https://pariselite.com

# ----------------------------------------------------------------------------
# TESTING
# ----------------------------------------------------------------------------

# Stripe Test Mode
STRIPE_TEST_MODE=false

# Test Customer Email (para testing)
TEST_CUSTOMER_EMAIL=test@pariselite.com

# ----------------------------------------------------------------------------
# SECURITY
# ----------------------------------------------------------------------------

# CORS Allowed Origins (comma-separated)
CORS_ALLOWED_ORIGINS=https://pariselite.com,https://admin.pariselite.com

# Rate Limiting
RATE_LIMIT_REQUESTS_PER_MINUTE=60

# ----------------------------------------------------------------------------
# CRON JOBS (Supabase Edge Functions)
# ----------------------------------------------------------------------------

# Configurar en Supabase Dashboard > Edge Functions > Cron
# 
# create-hold-job-v312:
#   Schedule: */60 * * * * (cada 60 minutos)
#   Timezone: Europe/Paris
#
# cleanup-expired-holds:
#   Schedule: 0 */6 * * * (cada 6 horas)
#   Timezone: Europe/Paris
#
# partner-sla-job:
#   Schedule: */30 * * * * (cada 30 minutos)
#   Timezone: Europe/Paris

# ============================================================================
# NOTAS IMPORTANTES
# ============================================================================
#
# 1. STRIPE_WEBHOOK_SECRET_V312:
#    - Crear un webhook endpoint en Stripe Dashboard
#    - URL: https://your-project.supabase.co/functions/v1/stripe-webhooks-v312
#    - Eventos a escuchar:
#      * payment_intent.succeeded
#      * payment_intent.payment_failed
#      * setup_intent.succeeded
#      * setup_intent.setup_failed
#      * payment_intent.amount_capturable_updated
#      * charge.captured
#      * payment_intent.canceled
#
# 2. STRIPE_WORST_CASE_FEE:
#    - Usar valores conservadores para validación de márgenes
#    - Percent: 3.5% (incluye fees internacionales)
#    - Fixed: €0.25 (fee fijo por transacción)
#
# 3. HOLD_JOB:
#    - Ejecutar cada 60 minutos
#    - Crear holds a T-24h del pickup
#    - Manejar SCA con deadline de 2h
#
# ============================================================================

